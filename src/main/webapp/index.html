<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
</head>

<body>
	<center>
		<div id="time"></div>
	</center>

	<center>
		<h1 id="title">All Hanzi</h1>
	</center>

	<center>
		<div id="search">
			Search: <input id="search" type="text" />
			<button type="button" onclick="searchHanzi()">Search</button>
		</div>
	</center>

	<center>
		<div id="found"></div>
	</center>
	<br />

	<center>
		<div id="data"></div>
	</center>
	<br />

	<center>
		<button type="button" onclick="getAllHanzi()">Get all data</button>
	</center>


	<script>
		//Execute a "displayTime()" and "getAllHanzi()" method immediately after a page has been loaded:
		document.body.onload = function() {
			displayTime();
			getAllHanzi();
		}
		
		//A function to display time
		function displayTime() {
			var date = new Date();
			document.getElementById("time").innerHTML = date;
			//will display time again, every 1001 miliseconds
			timer = setTimeout("displayTime()", 1001)
		}
		
		//A function to get all data from hanzi_data table by requesting to the controller
		function getAllHanzi() {
			//make request to HanziController using ajax.
			//ajax programming use XMLHttpRequest()
			var ajax = new XMLHttpRequest();

			//must use this block code, to read the http response body:
			ajax.onreadystatechange = function() {
				//When readyState property is 4 and the status property is 200, the response is ready:
				if (this.readyState == 4 && this.status == 200) {
					console.log("getAllHanzi(), responseText: " + ajax.responseText);
					var responseString = ajax.responseText;
					
					//if the json is null, or the json is empty, then print error message
					if (responseString == null) {

						document.getElementById("data").innerHTML = "Cannot get the data !";
						return;
					} else {
						//convert from string into javasript object:
						var responseObject = JSON.parse(responseString);
						
						//get the "hanzi" and "created_date" from json 
						var result = "";
						for (i in responseObject.hanzi_data) {
							console.log(i);
							var hanzi = responseObject.hanzi_data[i].hanzi;
							var created_date = responseObject.hanzi_data[i].created_date;
							result = result + hanzi + " " + created_date
									+ "<br/>";
							document.getElementById("data").innerHTML = result;
						}
					}
				}
			}

			//setting the http request
			ajax.open("POST",
					"http://localhost:9097/learn-hanzi/api/hanzi/getAllHanzi",
					true);


			//send the http request
			ajax.send();

		}
		
		//A function to search the unique hanzi from hanzi_data table by requesting to the controller
		function searchHanzi() {
			//make request to HanziController using ajax.
			//ajax programming use XMLHttpRequest()
			var ajax = new XMLHttpRequest();
			
			//must use this block code, to read the http response body:
			ajax.onreadystatechange = function() {
				//When readyState property is 4 and the status property is 200, the response is ready:
				if (this.readyState == 4 && this.status == 200) {
					console.log("searchHanzi(), responseText: " + ajax.responseText);
					var responseString = ajax.responseText;
					
					//if the json is null, or the json is empty, then print error message
					if (responseString == null) {

						document.getElementById("search").innerHTML = "Not Found !";
						return;
					} else {
						//convert from string into javasript object:
						var responseObject = JSON.parse(responseString);
						
						//get the "hanzi" and "created_date" from json 
						var result = "";
						for (i in responseObject.hanzi_data) {
							console.log(i);
							var hanzi = responseObject.hanzi_data[i].hanzi;
							var created_date = responseObject.hanzi_data[i].created_date;
							result = result + hanzi + " " + created_date
									+ "<br/>";
							document.getElementById("search").innerHTML = result;
						}
					}
				}
			}
			
			//setting the http request
			ajax.open("POST",
					"http://localhost:9097/learn-hanzi/api/hanzi/searchHanzi",
					true);

			//You must call setRequestHeader()after open(), but before send().
			ajax.setRequestHeader("Content-type","application/json;charset=UTF-8");
			
			//send the http request, with request body, json from input text box
			ajax.send({"search_hanzi":"ä½ "});

		}
	</script>
</body>
</html>